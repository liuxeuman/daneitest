# Day 01

# Jmeter性能测试

目录：

[TOC]



## 一、接口测试、性能测试项目的介绍

### 1.项目名称：网站稿件管理发布系统

B/S架构的Web应用

大致需求：针对稿件、文档信息的CURD操作
CURD就是“增删改查”既可以是**业务层面**，也可以是**数据库操作**层面

​					find	add	modify	remove		create	insert	update	select	

Create	Update	Read	Delete
创建		更新		读取		删除

比如：

​	增：增加稿件、上传文档doc txt jpg、用户注册
​	改：修改稿件、审批稿件
​	查：查询稿件、显示稿件、查询文档
​	删：删除稿件、删除文档

### 2、软件测试和软件工程的关系（面试题）

项目竞标：售前工程师	标书、演讲、谈判
		获得项目的开发权、测试权	"投其所好"互动、共鸣

#### 软件工程的基本流程：

​		需求分析->系统的分析与设计->开发->测试->实施

#### 1）需求分析：需求分析师、产品经理

根据和客户交流的内容，凭借项目经验总结出需求，编写文档；
	**《需求规格说明书》**作为后续所有流程的重要依据：

功能性——功能需求、非功能性——性能需求、安全需求
性能出于功能，并高于功能！

##### <1>功能需求：业务流程、行业规则、行业规范或标准	正确和错误的依据

##### <2>性能需求：多、快、好、省

##### 	面试题：列举出常见的**性能测试指标**？（重要）

###### 多：用户多、数据量大（大数据）、任务多、并发量大

​		在线用户数：多少人登陆并使用系统
​		并发用户数：在几乎同一时刻访问系统的某功能的用户数
​		点击率：Hits	per	Second	每秒来着用户的请求数	形容压力的大小
​		吞吐量：Throughputs	服务器在一定时间内处理的数据包的量
​		大数据量测试：模拟系统积累海量数据时的性能表现

​	数据库的优化技巧：索引 index
​				为表中的某些列（字段）建立索引，能够大大提高查询速度

​												name								根据name查员工的速度
比如：select id,name from emp where name="xxx";

大量的数据好比厚厚一本书，索引好比书中目录，根据目录查很快！
不加索引：逐行扫描，效率低
加了索引：精确定位，效率高（数据库表中的物理行）

###### 快：请求响应时间

​		平均事物响应时间	ART	ATRT
​		Average Transaction Response Time
​		业内原则：258原则	大家快才是真的快！ 
​					2秒内，可以接受；5秒左右，可以忍受；超过8秒，难以忍受！
​	请求响应时间=客户端时间 + 网络时间+服务器时间



客户端浏览器——网络——服务器Server
												（Web服务器 + 数据库服务器）

登陆请求——————》接口程序SQL———〉查询select
成功响应〈———————继续处理〈————结果

据大量项目表明：许多（60%以上）性能问题出现在数据库层面！

###### 好：系统稳定性好（路遥知马力）

​		7*24	多用户、多任务、多跑一会 ————在线综合场景测试
​		某些性能测试场景需要反复压测1小时以上，观察系统稳定性；

###### 省：节省系统资源，由于压力增大，会出现系统资源短缺问题，容易成为系统的性能瓶颈！

​		功能的问题（bug缺陷）
​		性能的问题（瓶颈）引起性能不良的地方
​		安全的问题（漏洞）

系统资源：CPU、Memory、Disk、Network等
Cpu使用率：阈值
		阈值：如果超过该值，系统容易出现性能瓶颈！

Memory 内存使用率：阈值	一般不超过80%

Disk 磁盘读写率：不能过高，否则影响效率
			磁盘读写速度远慢于内存、CPU，任务频繁读写磁盘，会影响速度！

网络传输率：不能过高，一般不超过网络带宽的一半！

##### <3>安全需求：通过安全测试（渗透测试、注入攻击），证明系统能否抵御常见的安全攻击；（网络安全工程师）攻击机 攻击	目标靶机

比如：SQL注入攻击（SQL Injection）
		用户填写的信息成为了SQL的一部分，改变了SQL原有的逻辑；

登陆界面：	有效的								具有安全隐患的数据	注入了一些特殊信息			Username：jojo									hehe
			Password：bean									'123' or '1'='1
						Login登陆

后台SQL：如果结果>0，说明找到用户记录，登陆成功！
		select count(id) from users 
		where username='jojo' and password='bean';
							真					与				真
						结果为真

select count(id) from users 
		where username='hehe' and password='123' or '1'='1';
						假						与				假
													假							或		永真式
													结果为真，表示登陆成功

#### 2）系统分析与设计：系统分析师、架构师、高级软件工程师、项目经理

​										DBA数据库管理员
《接口文档》、《开发文档》、《数据库设计说明书》

##### 3）开发：程序员	根据需求和设计，开发软件代码、调试

##### 4）测试：测试员	根据需求编写用例、执行，缺陷管理、提交报告

功能测试、性能测试、安全测试；
手工、自动化.....

##### 5）实施：实施工程师	将测试过的产品部署到客户那里，维护和使用

##### 	如果遇到问题，及时反馈，调整和优化

## 二、性能测试的基本概念

### 1、性能测试：好比一场有计划、有策略的“攻坚战”

​										测试机						压测					被测系统服务器
简而言之：严阵以待、想方设法、放马过去、方知厉害

#### 1）严阵以待：搭建好性能测试环境

测试机器：安装Apache Jmeter 或 HP LoadRunner
						性能测试工具
被测系统：Web服务器、数据库服务器、初始测试数据
					Tomcat				Mysql				准备好了
网络环境：性能测试建议内网测试！避免外网访问的各种限制
					HTTP响应码 429	Too many	requests！太多的请求

#### 2）想方设法：制定性能测试计划、提供测试策略

测试计划：人力、物力、财力	进度表、分工、资源分配、评判标准、风控要求.
测试策略：

##### <1>基准测试：模拟最小压力，提供测试的起点、参考		单兵作战

##### <2>递增测试：逐步加压、发现性能变化趋势	用户数、点击率、访问频率

##### <3>并发测试：多用户在几乎同一时刻一起对某功能进行并发访问

​							瞬时压力

##### <4>在线综合场景测试：多用户、多任务、多测试一段时间

##### <5>数据容量测试：模拟大量数据，测试系统反应

##### ...

#### 3）放马过去：使用性能测试工具，根据需求、测试计划、用例，执行测试

#### 4）方知厉害：观察测试结果是否符合性能需求！战后分析与统计 写测试报告

​	概括为：模拟真实的生产环境，根据需求制定性能测试计划，使用性能测试工具执行计划，观察测试结果是否满足性能需求。

## 三、Jmeter的核心技术

###   1.什么是Jmeter？

​	Jmeter是由Apache软件基金会组织提供的开源的、免费的、轻量化的、Java开发的一款接口测试工具、性能测试工具；

​	作为客户端通过大量网络协议向服务器发送请求，可以测试目前业内主流的接口
​		（比如：HTTP协议、HTTPS协议、JDBC协议等）

​	由于能够模拟大量的用户（虚拟用户VU  Virtual User），可以发起压力，测试接口乃至服务器后台的性能；（牵一发而动全身）

​	原理：运行Java出现需求KVM（Java虚拟机	是一个进程Process），如果后续要发起多任务，一定是多线程（Thread）；

​	进程Process：正在执行的程序；比较消耗系统资源（重量级）
​	线程Thread：在进程中发起的多任务为多线程；比较节约系统资源	
​							一台测试机能够发起更多的VU，发送请求，访问接口

学习方法：多思考、多比较，工具为何这么设计
		Postman、Jmeter，其他：Fiddler等

### 2.安装和使用Jmeter（搭建测试机环境）

#### 1）安装JDK，配置环境变量

```
目前使用JDK1.8 （主流）	Java开发工具包
凡事基于Java开发的产品，都需要JDK的支持，比如JMeter、服务器软件Tomcat、手机测试工具monkeyrunner等...

JMeter5.3版本要求JDK1.8支持
需要配置系统环境变量：
JAVA_HOME:JDK的安装目录
PATH:命令的搜索路径	将JDK的bin目录追加到PATH值中
		为了让系统找到JDK1.8的工具，比如java.exe命令
```

#### 2）安装JMeter

```
解压即可：apache-jmeter-5.3.zip
目录结构：
<1>bin目录：常用命令、启动项
	jmeter.bat	给windows系统使用	批处理文件、命令
	jmeter.sh		给Linux系统使用shell	命令		java	跨平台
要求：修改系统环境变量PATh，将jmeter.bat所在目录名，追加到PATH中，为了后续
<2>lib目录第三方类库	class	libary	大量的jar包
		将开发好的Java类，程序打包为压缩包，供JMeter使用
	对JMeter工具的拓展，比如需要访问数据库，添加数据库驱动包 Mysql.jar
	比如：为JMeter扩展功能，在exe目录（拓展），添加jar包
	
```

启动JMeter：运行jmeter.bat

​	出现一个客户端界面，界面中的关键？Test pian	测试计划

技巧：修改界面显示效果

```
修改稿件默认语言：
通过修改一个配置文件：bin\jmeter.properties  属性文件
							特点：大量的名值对	名=值			#表示注释
#设置工具默认语言风格	en	英语	zh_CN	中文
language=zh_CN
保存文件，重启Jmeter才生效
```

原理：使用JMeter界面配置测试计划（直观），保存后是一个jmx文件（便于保存）
	jmx：JMeter的XML配置文件

```xml
<?xml version="1.0" encoding="UTF-8">
<jmeterTestPlan version="1.2" properties="5.0" jmeter="5.3">
  	嵌套添加其他节点，通过工具界面配置进行
  	比如：线程组、取样器（请求）。。。
  	工具会自动记录配置信息
</jmeterTestPlan>
```

### 3、JMeter测试计划基本要素

面试题：JMeter的一个测试计划中有哪些要素？思路：先整体，后局部

#### 1）根节点：测试计划	是其他节点的最顶层“容器”

配置内容：

##### <1>用户定义的变量：配置计划中的全局变量

​	定义名称 和 值，后续如何使用？${变量名}
​	比如：ip1	192.168.2.19
​	使用时：${ip1}	对比Postman的“小眼睛”使用{{ip1}}

##### <2>独立运行每个线程组：一般不选中，如果选中，表示“串行执行”

##### <3>添加第三方的jar包，库 为了拓展

​	比如：添加数据库驱动mysql.jar	仅供当前计划使用
​	如果添加到Jmeter的lib下，所有计划都可用（全局、共享）

![image-20220531160817430](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220531160817430.png)

#### 2）“测试计划”下，添加1个或多个“线程组”：ThreadGroup

目的：管理虚拟用户，对接口进行访问
				（VU 虚拟用户 多线程模拟）

![image-20220531163620012](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220531163620012.png)

##### <1>线程数：

线程组中可以配置1个或多个线程，模拟1个或多个用户：
	功能测试时：1个VU
		调试时，先使用1Vu运行，分析请求发送的轨迹，便于调试；
	性能测试时：多个VU	发起更大的压力

##### <2>在取样器错误后要执行的动作：

​		（请求）

请求错误后，可以：继续	发送后续的请求

##### <3>Ramp-UP时间（秒）：1

表示以上虚拟用户准备在多久时间内就位（预备阶段）

##### <4>调度器：控制用户执行多久

3)"线程组"下，添加“取样器”（Sampler）：就是常用协议的请求

​	取样：对请求协议细节的捕捉、描述
​	目前：HTTP请求	按照接口文档、用例设计填写细节

![image-20220531194349289](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220531194349289.png)

```
名称：test01_multi_params接口
注释：基于HTTP协议，以Get方法，使用有效的id和username查询用户的注册时间，返回预期的JSON结果
对比Postman的配置效果：Get方法
http://{{ip1}}/apitest/multi-params/?id-1&username=admin
协议名：//主机名：端口/应用名/功能名/？参数名=参数值&参数名=参数值&...
							:80								QueryString 	查询字符串
改版为JMeter：
<1>协议：HTTP
<2>服务器的名称或IP:${ip1}		使用全局变量
<3>端口号：默认不填
<4>请求的方法：默认Get
<5>路径：/apitest/multi-params/
<6>内容编码：默认不写	如果中文编码出问题，建议改为UTF-8
<7>同请求一起发送的参数：添加
		名称			值
		id				1
		username	admin
```

配置效果：

![image-20220531194328093](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220531194328093.png)

#### 4）“测试计划”或“线程组”下，添加“监听器”：Listener（观察者模式）

​		作用范围不同

![image-20220531171346236](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220531171346236.png)

##### <1>察看结果树：和功能相关	请求包、响应包的分析

​			类似：Postman的Console 控制台
​			在响应数据中，可以选择不同察看角度：
​					Text	普通文本，适合看源代码
​					HTML网页页面效果，更直观
​					JSON	JSON格式化后的效果

问题1:IP地址不对

![image-20220531194143741](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220531194143741.png)

观察执行请求和响应：

![image-20220531194203500](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220531194203500.png)

问题2：URL地址写错

![image-20220531194218252](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220531194218252.png)

Jmeter工具条的介绍：

![image-20220531174116579](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220531174116579.png)

##### <2>图形结果：查看性能变化的趋势图	将执行轨迹数据	描点不划线

##### <3>用表格察看结果：察看性能结果明细	每次请求的细节

##### <4>聚合报告：察看性能结果统计	平均、最大、最小等



# Day02 



##### 练习1:Get方法根据商品类别编号查询商品页面

```
请求名称：Get方法访问京东商品列表
请求方法：Get
接口地址：https://list.jd.com/list.html?cat=9987,653,655
转化为JMeter的请求？
协议：HTTPS
服务器名称或IP：list.jd.com
端口号：默认不写	443
请求方法：Get
请求路径：/list.html		要求/结尾：/list.html/
请求参数：
	cat				9987,653,655
	
```

![image-20220601092102207](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601092102207.png)

添加监听器：察看结果树

运行计划，发送请求，观察结果

小结：JMeter测试计划的基本要素？

​		测试计划、线程组、取样器—HTTP请求、监听器-察看结果树

### 4、如何使用JMeter发送Post请求？

#### 1）“线程组”中新建：取样器（HTTP请求）

```
请求名称：Post验证用户名和密码
注释：以Post方法，根据用户名和密码验证登陆是否成功
请求方法：Post
接口地址：http://服务器IP/apitest/login/
请求参数：
	username		admin
	password		123456
在“测试计划”中添加全局变量：ip1 	192.168.2.16
协议：HTTP
服务器名称或IP：${ip1}
请求方法：Post
路径：/apitest/login/
```

2）同请求一起发送的参数

规律：直接填写，由于目前是Post方法，JMeter会将请求参数放在请求Body部分携带：（通过察看结果树	请求包	可以验证）

```
参数名			参数值
username	admin
password	123456
```

![image-20220601095216197](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601095216197.png)

察看结果树：



请求头部：

![image-20220601095622719](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601095622719.png)

如果需要进行文件上传，可选择：对Post使用multipart/form-data
并且在“文件上传”选项卡中，添加上传的文件，可以选多个

效果：请求Body 中，会使用边界文本，将多个参数分隔开发送。（综合参数）

3）如果接口要求在URL后通过QueryString携带请求参数，可以在路径名后补充比如：/apitest/login/?age=23

执行效果：

![image-20220601102410802](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601102410802.png)

### 5、如何在请求的头部携带信息

现象：JMeter 不会自动添加，需要定制

“线程组”下，添加“配置文件”：“HTTP信息头管理器“->添加

​					名称										值
​			Accept-Encoding				gzip, deflate, br
​				可接受的格式					数据包压缩格式

​	区别：
​				如果在“线程组”下添加，是为了整个线程组负责，所有请求共享配置；
​				如果在“请求”下添加，只为该请求起作用。
![image-20220601103702820](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601103702820.png)

配置效果：

![image-20220601104019554](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601104019554.png)

​	执行效果：

之前：![image-20220601104056148](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601104056148.png)

之后：![image-20220601104211748](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601104211748.png)

### 6、如何为请求添加Cookie信息？

思路：JMeter具有自动管理Cookie的技术

#### 1）什么是Cookie？

由于HTTP协议默认是无状态的，默认不会跟踪用户之前的数据信息；
如果有需要，需要跟踪，携带用户之前的数据信息，可以采用Cookie、Session技术；比如：保持购物车状态、保持用户登陆后在线的状态

### 面试题：Session和Cookie什么区别？（Web开发的技术）

​	Session：会话	在Web服务器端保存用户状态信息的技术！
​	Cookie：	在客户端保存用户状态信息的技术

​			客户端：浏览器、Postman、JMeter等

​			形式：名=值	名值对		文本形式		num=50

JMeter的优势：只要添加Cookie管理器，工具会帮助我们自动管理Cookie信息

“线程组”下，添加“**配置元件**”：“**HTTP Cookie管理器**”

![image-20220601105505837](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601105505837.png)

执行效果：请求中会携带Cookie信息

![image-20220601111718396](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601111718396.png)

![image-20220601111445202](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601111445202.png)

##### 练习：使用Cookie实现自动关联



```
应用场合：登录等业务
		登陆后，系统需要位置用户登陆状态，可以采用Cookie技术跟踪状态；
		确保后续请求确定用户已经登陆过！
		解决方法：添加Cookie管理器，能够自动管理Cookie信息！（开发实现的）
请求1:登录
http://服务器IP/apitest/refer/login/
功能：登录接口
请求方法：post
参数：username、password
请求类型：表单数据

请求2：获得用户信息
目的：登录后
测试接口
http://服务器IP/apitest/refer/info
功能：获得用户信息
请求方法：get
参数：无
结果：
  如果登录过，显示：悄悄告诉你！你的用户名是admin，密码是123456
  如果未登录过，显示：无法获得登录信息
```

步骤2:“测试计划”下添加“线程组”

步骤3:“线程组”下，添加请求

请求1:登陆![image-20220601120649748](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601120649748.png)

结果：![image-20220601120703793](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601120703793.png)

请求2：获得用户信息![image-20220601120556561](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601120556561.png)

问题：登录后无法跟踪登录后的状态信息![image-20220601120540704](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601120540704.png)

原因：

![image-20220601120001479](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601120001479.png)

解决方法：在“线程组”下添加“配置元件”：“HTTP Cookie管理器”，会自动管理Cookie，跟踪登录状态信息

执行效果：![image-20220601140825570](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601140825570.png)

请求1:发送后的响应中带有Set-Cookie，表示服务器通知客户端记录Cookie信息，表述服务器承认客户已经登录成功，创建一个会话Session的id值：

结论：Session是通过Cookie来跟踪的，根据Session的id找到会话。

由于添加了Cookie管理器，请求2，会携带之前的Cookie信息，从而实现SessionID的关联（自动关联）

![image-20220601141105786](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601141105786.png)

### 7、如何添加检查点？也称为“断言”Ass	ert

#### 目的：

​			性能测试一般是自动化测试，测试过程中会访问许多接口；
​			需要确保请求、事务的成功率	比如控制在99.5%以上；
​			在业务正常执行的情况下，才有必要看性能如何；
​			性能的要求出于功能，并高于功能；
​	通过添加检查点，能够对功能结果进行自动检查。

#### 步骤：

#### 1）找到“相应请求”：导致其响应结果需要检查的那个请求

因为发送了该请求（因），返回了响应（果），响应的结果需要检查的！
该请求就是“相应请求”

问题：如何判断、找到该请求？

思路：使用“**察看结果树**”根据请求和响应包的关系，确定该请求
			请求中有参数、条件，响应结果有响应码、响应文本（业务数据依据）

建议：先使用1个用户执行请求，确保请求序列按照顺序执行（没有被打乱）
			![image-20220601144546471](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601144546471.png)

#### 2）在“相应请求”下，添加“断言”：“响应断言”

对比：

​	“线程组”下加，组下所有的请求都会检查，是共享的；适合HTTP响应码200使用
​		便于统一管理

​	“某请求”下加，只为某请求检查

![image-20220601145011038](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601145011038.png)

```
比如：在请求1下，添加“响应断言”
<1>名称：响应断言-1	HTTP响应码
<2>注释：检查HTTP响应码为200
<3>Apply to：作用范围		默认Main sample	only
	1.Main sample and sub-samples		自己和子节点	都会检查
	2.Main sample only		只有自己会检查
	3.Sub-samples only		只有子节点会检查
<4>测试字段：
	1.响应文本：HTTP响应包主体文本
		Response Body
	2.响应代码（响应码）：HTTP响应头部的响应码（目前选择）
		Response Code 	比如：200	301	302		404		500
	3.响应头：对响应头部信息检查	
<5>模式匹配贵州：选择“包括”，表示含有某文本
<6>测试模式：通过”添加“，填写预期的结果文本
	添加：200 
<7>自定义失败消息：预期HTTP响应码为200，而实际不是！
		检查失败时的提示信息
		
```

配置效果：![image-20220601152647308](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601152647308.png)

#### 3）在“测试计划”或“线程组”下，添加“监听器”：“断言结果”

能够对断言结果进行提示，类似Postman中的Test Results

检查通过，只显示请求的名称；

出现错误，会提示：

```
登录
	响应断言-1HTTP响应码 : 预期HTTP响应码为200，而实际不是！
```

结合“察看结果树”核对请求包、响应包数据，分析和调试。

技巧：将响应断言-1拖拽到“线程组”下，所有请求共享使用检查点
			线程组下的请求都要检查响应码200

#### 小结：添加检查点 三步骤？

找到相应请求、添加断言——响应断言、添加监听器——断言结果

###### 练习：针对登陆请求的结果文本进行检查，预期含有：用户admin登陆验证成功

```
<1>找到相应请求：登陆
<2>在相应请求下，添加“断言”
	名称：响应断言2 响应文本
	注释：针对响应文本进行检查，含有用户名信息
	应用范围：默认		当前请求
	测试字段：默认		响应文本
	模式匹配规则：包括
	测试核心：用户admin登陆验证成功
	自定义失败消息：响应文本中未出现登陆验证成功！
<3>监听器：断言结果	（已经有了）
```

运行结果：![image-20220601155808629](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601155808629.png)

练习：对请求2，添加断言，预期结果含有：你的用户名是admin

```
<1>找到相应请求：请求2 获得用户信息
<2>在相应请求下，添加“断言”
	名称：响应断言3 响应文本
	注释：针对响应文本进行检查，含有用户名信息
	应用范围：默认		当前请求
	测试字段：默认		响应文本
	模式匹配规则：包括
	测试核心：你的用户名是admin
	自定义失败消息：响应文本中未出现你的用户名是admin
<3>监听器：断言结果	（已经有了）
```

配置结果：

![image-20220601160744288](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601160744288.png)

### 8、添加”事务“：Transaction

目的：性能测试中特别关心一些和事务有关的指标：

​		平均事务响应时间：ART	 **A**verage  **T**ransaction **R**esponse **T**ime
​		最大、最小事务响应时间：Max	Min
​	事务成功率		比如要求99.7%		成功率是否合理

​	每秒事务数：TPS	Transaction Per Second		处理能力高不高

事务：Transaction 

​		可以将某个、某些请求序列整合在一起，当作一个事务，表示一次业务动作
（Action），比如登陆、订票、查询稿件、修改稿件、上传文档....

​	便于在性能测试时获得和事务有关的性能指标，尤其是：ART、TPS

添加方式：

#### 1）在“线程组”下，添加“逻辑控制器”：“事务控制器”

名称：事务控制器-登陆并检查

![image-20220601170248413](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601170248413.png)

#### 2）将一个或者多个请求转移到事务下管理：有则拖拽，无则新建

![image-20220601170641549](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220601170641549.png)

#### 3）在“监听器”中观察和事务有关的结果

用表格察看结果、聚合报告、TPS

思想：系统中处处流淌着的是“事务”
			包括数据库，表示要么一起成功，要么一起失败的一端完整业务操作！
			性能测试中将事务作为不同的指标来“度量”，比如TPS、ART等

复习：JMeter测试计划中要素有哪些？



​	察看结果树中的异常：HtppHostConnectException	Http主机连接异常
​		原因：服务器的Ip地址改变了，测试计划中需要调整全局变量ip1

### 问题：Session和Cookie的联系和区别？（面试题）

1）前提：HTTP是一种简单的、无状态的协议；
		简单：数据包结构，头header和主体body
		无状态：一次请求，一次响应后，前后端默认不会记录用户状态
		需求：平时需要记录用户状态，比如购物车、登陆后保持用户登陆状态

2）解决办法：

​	Session：在服务器端保持用户状态的技术	会话	好比店里为用户准备的盒子
​						通过Session找到不同用户的“盒子”

​	Cookie：在客户端（浏览器、JMeter）保存用户状态的技术	小纸条	名：值
​					Sessionid=123

3）Session和Cookie的关系：Session的id是靠Cookie来跟踪的！
		比如：先登陆后察看用户信息

​		请求1:登陆	提交用户名和密码
​		响应1:响应的头部 通知 客户端JMeter记录Cookie（添加Http	Cookie管理器！）
​		Set-Cookie: PHPSESSID=onpr64pqll8hb1dql82qp7dh13
​			设置Cookie	名=值

请求2:获得用户信息 	携带Cookie，将Sessionid发送，找到服务器的Session
		请求的头部会携带客户端的Cookie，为了再次访问服务器时能找到Session
		从而实现了接口的关联！

```
Cookie Data:
PHPSESSID=onpr64pqll8hb1dql82qp7dh13
```

​	响应2:返回用户信息（证明找到了服务器的Session）

4）Cookie的其他用途：填写表单时，可以将填写的信息保存在Cookie中，后续前端能够自动获取并使用。

#### 面试题：添加检查点需要几步》（断言）

1）找到相应请求（因）：引起需要检查的结果的请求
		技巧：察看结果树

2）相应请求下，添加“断言”：响应断言
		针对响应码、响应文本进行检查

3）监听器：断言结果

#### 面试题：JMeter中为何要添加事务？

答：为了将一些有关的请求整合成一个整体，叫事务
		为了获取和事务有关的性能指标：
				聚合报告：ART	平均事务响应时间	最大、最小时间
				TPS：每秒事务数 Transaction Per Second	

### 9、在自动化测试中添加步骤的等待时间？

#### 1）说明：步骤，就是每个请求

​			让步骤有秩序的执行，符合业务的基本要求，不能太急促；
​			比如某些请求执行需要一段时间，等待完成后才能发送后续请求；
​		模拟平时用户的操作步骤等待，更真实；
​		测试性能时，可以通过调节请求间隔时间来调节压力大小：间隔时间越长，对服务器的压力越小。

#### 2）类比：目前自动化技术中有哪些等待技巧？（触类旁通）

​	

| 工具         | 操作或代码                             | 说明                   |
| ------------ | -------------------------------------- | ---------------------- |
| Postman      | Run中的Delay 延迟 毫秒                 | 接口自动化             |
| LoadRunner   | lr_think_time(秒数)；类C语法           | 性能自动化             |
| Monkey       | adb shell monkey...--throttle 2000毫秒 | 手机自动化             |
| monkeyrunner | MonkeyRunner.sleep（秒数）PYthon       | 手机功能自动化         |
| Selenium     | sleep（秒数）Python                    | Web功能自动化          |
| Linux        | sleep 秒数                             | shell脚本              |
| Java         | Thread.sleep（毫秒数）                 | Java代码               |
| JMeter       | 定时器 Timer                           | 接口自动化、性能自动化 |

#### 3）JMeter的定时器：让请求之间产生时间间隔

效果：在某个请求下添加定时器，会在请求发送之前等待一段时间；
			在线程组中 或 事务控制器下 添加定时器，组下的所有请求都受影响，在请求之前都会等待；多次添加形成累加效果。

##### <1>固定定时器：固定等待一段时间（时间更精准）

![image-20220602103927291](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220602103927291.png)

![image-20220602104555457](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220602104555457.png)

##### <2>高斯随机定时器：按照高斯定理（正态分布）进行随机等待；（显得更真实）

正态分布：多个数据按照正态分布曲线进行概率分布
					——满足大概率事件	随大流

![image-20220602105705771](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220602105705771.png)

偏差（毫秒）：1000
固定延迟偏移（毫秒）：3000
效果：以3秒为中心，前后偏移1秒为范围，满足正态分布
			越靠近3秒概率越高，越远离3秒概率越低

二八定律：80-20原则	80% 20%	类似正态分布
				80%的缺陷一般出现在20%的区域；满足大概率事件
			启发：凭借经验进行分析和定位
				80%的交易量可能发生在一天20%的时段内：

###### 性能指标：TPS	每秒事务数	测试需求中如何制定？

​		需求：已知某系统每天最多提交100000笔订单，请问TPS定多少合适？

​		分析：每次订单提交就是一次事务
​			按照二八原则：20%的订单发生在一天20%的时段内
​		（100000*80%）/（24x60x60x20%）
​		=4.63笔/秒
​		平均每秒能够完成4.63笔事务

墨菲定律：不太可能发生的事情有时容易发生	幂律分布
				有时小概率事件容易发生！
			启发：有时意想不到的地方，容易出现问题。

##### <3>同步定时器：Synchronizing Timer	用于并发测试，作为集合点！

​	对比：透明	生活中表示看得见	能够透过看见
​							计算机中表示看不见	不需要看见内在，但可以使用到
​		同步：等待A任务完成后，B任务才能开始	B随同A之后
​					软件开发中，多任务共享一些数据，为了避免数据冲突，使用同步技术；
​					等待A任务处理完后，B任务才能使用！

​		异步：A任务正在执行时，B任务也可开始	异步请求

### 10、如何进行一次并发测试？（重要的面试题）

​	含义：并发测试属于性能测试中的一种重要策略
​				多用户在几乎同一时刻对某功能点（事务）进行瞬时访问，形成严格的并发操作

​	关键点：集合点
​		重要技术：“同步定时器”	Synchronizing Timer
​			多用户之间的等待，等待达到并发用户数时，才继续发送请求
​			等待多用户到达集合点时才一起并发执行
​			此时形成严格的并发压力！

对比：之前的定时器是请求之间的等待（时间到才发请求），同步定时器是在多线程（多用户）下，用户之间的等待，等待到齐才并发！（等用户到齐才发请求）

#### 需求：针对某事务，添加集合点，进行3VU的并发测试

#### 1）设计一个事务：“事务控制器”

​		将有关的一个或多个请求封装在一个事务范围内（业务边界）

​		好处：
<1>既能获得和事务有关的指标：平均事务响应时间ART、每秒事务数TPS、最大失误响应时间、事务成功率...

<2>又能够作为集合点的开始位置，表示多用户对某事务进行并发访问！

#### 2）在某“事务”或某“请求”下，添加子节点“定时器”：同步定时器！

​			Synchronizing Timer

​	多VU之间同步、等待，等待大家到齐后一起并发执行后续请求！

![image-20220602141545516](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220602141545516.png)

<1>名称：同步定时器

<2>注释：作为多用户并发执行的集合点

<3>模拟用户组的数量：默认0	表示所有的线程（用户）都参与并发
								3	期望达到3个用户并发

<4>超时时间（毫秒）：默认0	表示无限等待
		10000表示等待10秒，如果用户未到齐，会先执行已到达的用户；

#### 3）在线程组设置合理的线程数：3 VU	模拟的用户  要充足

#### 4）在“测试计划”或”线程组“下添加和性能监控有关的”监听器“：

​	<1>图形结果：性能变化的趋势

​	<2>用表格察看结果：每次请求、事务的性能明细

​	<3>聚合报告：多次请求、事务执行的汇总统计
​					尤其是ART：平均事务响应时间、最大事务响应时间

​	<4>TPS:Transactions Per Second	每秒事务数

#### 5）结合递增测试策略，逐步增压，增加并发用户数，观察性能指标的趋势

​	<1>修改“同步定时器”中的期望用户数	10 VU的并发

​	<2>修改“线程组”中的实际用户数	10

#### 练习：根据登陆请求添加事务，执行5～20VU的并发测试

​	测试思路：1～20分为4个节点，分别进行5VU、10VU、20VU的并发测试

```
接口文档要点：
请求方法：POST
接口地址：http://服务器ip/apitest/login/
请求参数：提供有效的用户名和密码
			username		password
预期结果：{"Status":1000,"Result":"Usercheck ok","Message":"登录验证成功"}
思路：性能测试的数据准备基本都是有效数据，促进功能的成功实现；
			在功能正常实现的情况下，考察系统性能情况！
```

1）新建测试计划3，添加全局变量ip1

2）测试计划下，新建线程组，先1VU，调试功能

3)在线程组下，新建逻辑控制器——“事务控制器器”：事务控制器-登陆

4）“事务控制器”下，添加“取样器”：“HTTP请求”

​	<1>名称：验证用户名和密码

​	<2>注释：以Post方法提交表单，验证用户名和密码的有效性

​	<3>协议：HTTP	

​	<4>服务器名称或IP：${ip1}

​	<5>请求方法：Post

​	<6》路径：/apitest/login/

​	<7>参数：
​				username			admin
​				password			123456

5）针对“测试计划”，添加监听器：察看结果树

6）添加断言：检查点

​			HTTP响应码为200
​			响应文本含有：登陆验证成功

​	步骤：1.找到相应请求 	2.添加响应断言	3.添加监听器——断言结果

​		名称：响应断言1:HTTP响应码
​		注释：检查HTTP响应码为200
​		应用范围：默认Main samole inly	仅自己
​		测试字段：响应代码（响应码）
​		模式匹配规则：包括
​		自定义失败消息：预期HTTP响应码为200，而实际不是！

​		名称：响应断言2:-响应文本
​		注释：检查响应文本的状态吗和提示信息
​		应用服务：默认	仅自己
​		测试字段：默认	响应文本
​		模式匹配规则：包括
​		测试模式：添加两次
​		

![image-20220602155226777](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220602155226777.png)

7)针对“事务”添加定时器“：”同步定时器“	Synchronizing	Timer

​	模拟用户组的数据：0		全部线程

​					5		10		15		20	期望的并发用户数

8）“线程组”中设置实际的线程数：实际的VU数	5	10 	15	20

9）添加和性能测试有关“监听器”

​		图形结果、用表格察看结果、聚合报告、TPS

10）结果对比：

​	

| 并发用户数 | 平均事务响应时间ART（毫秒） |
| ---------- | --------------------------- |
| 5          | 54                          |
| 10         | 41                          |
| 15         | 55                          |
| 20         | 61                          |



### 11、如何进行参数化？

#### 1）目的：将脚本中的业务数据进行改变，满足更真实的用户体验；

​					平时用户提交的数据不是千篇一律的，而是时常变化的；

​				某些需求要求业务数据必须改变？比如：用户注册
​						用户名、手机号、邮箱号、文件名	要求不能重复！
​						脚本要参数化，动态改变数据，促成自动化成功执行；

#### 2）核心：参数化也叫“变量化”

​			变量名、参数名	代表一些值

​					不变						会改变
​			username					admin	tom	mary
​			以不变应万变

#### 3）关键：

​		入参：请求携带的数据	条件、因	请求的参数
​		出参：响应结果返回的数据	结果、果	需要检查的预期结果

考虑哪些方面？类型+数据+策略	以JMeter为例分析

#### 4）类型：

<1>全局变量：在“测试计划”中配置“用户定义变量”	名值对

​		比如ip1			使用时：	${ip1}
​	作用域：对整个测试计划可用，值比较单一、统一使用

<2>使用“配置元件”：CSV Data Set Config
										CSV数据设置配置

​		将参数化的数据存储在文本文件中，供运行时自动读取

​	CSV：逗号分隔值	用英文逗号将每一列隔开

```
username,password,status,message
admin,123456,1000,登录验证成功
hehe,123,1003,用户名或密码错误
admin,123,1004,密码错误
```

![image-20220602172033840](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220602172033840.png)

![image-20220602174216547](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220602174216547.png)

#### 5)配置内容：

<1>名称：CSV数据文件设置

<2>注释：针对登陆的入参和出参进行设置

<3>文件名：使用相对路径	users.txt	要和测试计划3.jmx放在同一目录下
						或使用绝对路径：D：\xxx\xxx\users.txt

<4>文件编码：可明确选择UTF-8	表示UTF-8方式读取文件内容

<5>变量名称：username,password,status,message
				（拷贝users.txt的列名，就可作为参数名）

<6>忽略首行：True	users.txt中的表头会忽略，不能作为数据
		其他默认：

6)在请求中修改入参
		${username}	${password}

![image-20220602175642203](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220602175642203.png)

​	在断言中需要修改出参
​		${status}	${message}

![image-20220602175816765](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220602175816765.png)

设置3个用户，批量执行数据：

错误提示：

![image-20220602180640073](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220602180640073.png)

正确结果：

![image-20220602180707054](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220602180707054.png)





# Day04

如果JMeter出现异常，如何分析？

```
					非法	参数			异常			不能				读		文件		头	行
java.lang.IllegalArgumentException:Coule not read file header line for file users111.txt	对于文件users111.txt
	底层提示不要看
原因：								非法	参数		异常
Caused by :java.IllegalArgumentException:file users111.txt must exist and be readable 文件必须存在	或 可读 
	底层提示一般不用看。。。
说明：文件users111.txt	不存在	或	缺少可读性权限！
```

如果CSV数据配置中，未忽略首行，导致第一行被当作数据使用！

![image-20220606104239702](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220606104239702.png)

![image-20220606105456996](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220606105456996.png)

说明：如果多用户选取的数据不能重复出现，需要将是否循环改为False，避免数据重复使用，出现业务问题，性能测试要先促成功能的实现！

线程共享模式：默认“所有线程” All Threads

数据共享策略：多线程（多用户）依次交替使用数据
	VU1:第1行	admin,123456,1000,登录验证成功
	VU2：第2行	hehe,123,1003,用户名或密码错误
	VU3:		第3行	admin,123,1004,密码错误
		。。。。。。

#### 练习：针对判断账户信息接口进行参数化

```
接口功能：根据Id和username查询账户和注册时间，若存在，则返回注册时间，若不存在，则返回“用户信息不存在”
接口地址：http://服务器ip/apitest/multi-params
请求方法：Get
请求参数：id和username
				比如URL?id=1&username=admin
返回结果：比如有效："注册时间": "2020-07-15 15:30:47"
				如果不存在，显示“用户信息不存在”

```

##### 1）新建测试计划4，设置全局变量：ip1，值：192.168.2.18

##### 2）“测试计划”下，新建“线程组”，默认1个用户

##### 3）“线程组”下，新建取样器：HTTP请求

##### 4）“测试计划下，添加监听器：察看结果树

![image-20220606115629526](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220606115629526.png)

##### 5)在当前请求下，添加“断言”

名称：响应断言1-HTTP响应码
注释：检查HTTP响应码为200
提示：预期响应码为200，而实际不是

名称：响应断言2—响应文本
注释：检查响应文本含有预期注册时间或错误提示
提示：未查到预期注册时间

##### 6）在“测试计划”下添加“监听器”：断言结果

参数化：类型（CSV数据配置） + 数据（CSV数据文件） + 策略（循环重复取值）
				设计好入参、出参

##### 7)为参数化准备测试数据：和测试计划在同一目录下user2.txt

注意：文本格式，不要有多余的空白；
			资源文件的字符集也要统一，比如另存为UTF-8

```
id,username,expect
1,admin,2020-07-15 15:30:47
2,Dumb,2020-07-15 15:30:47
3,Superman,2020-07-15 15:30:47
4,heh,用户信息不存在
5,haha,用户信息不存在

```

##### 8）在“线程组”下，新建“配置元件”：CSV Data Set Config

<1>名称：CSV数据文件设置
<2>注释：针对账户检查的入参和出参进行参数化
<3>文件名：user2.txt
<4>字符编码：UTF-8
<5>变量名称：id, username,expect
<6>忽略首行：True	第一行是列名，需要忽略
<7>分隔符：默认逗号，
<8>是否允许带引号：默认False
<9>移动文件结束符再次循环：默认True 	是
<10>遇到文件结束符停止线程：默认False	不用
<11>线程共享模式：默认	所有线程

比如：![image-20220606144930604](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220606144930604.png)

##### <12>将请求中的条件改为入参 ${id} ${username}

​	将断言中的预期结果改为出参${expect}

问题1:user2.txt中存在多余的空白行，导致数据获取失败！

![image-20220606152154551](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220606152154551.png)

问题2:如果出现中文数据问题，很有可能和字符集有关，推荐使用UTF-8，字符要统一（CSV文件的编码、请求发送时的编码、CSV设置读取文件的编码、数据库的编码，都要统一！）——面试题：自动化测试中如何保证中文不乱码？

## 四、项目环境的搭建

### 1、测试机环境

1）物理机：Windows10系统，安装JMeter5.3	基于JDK1.8 64位
					配置好系统环境变量，比如PATH，可以使用命令执行JMeter
					为Jmeter5.3增加了插件plugin，为工具扩展功能，比如可以监控TPS（每秒事务数）

2）网络：局域网 内网测试
					性能测试建议采用内网测试，避免外网带来的各种限制！

3）Web代理调试工具，Flddler 接口测试辅助工具
			如果Fiddler无法正常安装，可能是Windows系统缺少.net插件，需要先安装插件：NDP451-xxx-x64.exe

4）安装Baddboy	
		双击运行，默认安装即可
**目的**：能够为Jmeter录制脚本的工具
					该工具会采用浏览器根据UI界面的操作，捕捉和记录HTTP协议的数据包，变为访问接口的请求序列，成为接口自动化的脚本；
		保存为：xxx.bb 文件	导出为xxx.jmx文件（JMeter的测文件）
				file->Export to JMeter
				文件	导出为JMeter
 **思想**：录制和回放
		录制：工具根据手工操作步骤，将协议记录为脚本；
		回放：工具根据脚本自动执行，重新发送之前的请求序列；

### 2、被测系统服务器环境

1）虚拟机：Windows7系统

2）安装liferay.exe  服务器软件（服务器端Server）	
		整合了：JDK1.6 + Tomcat + MySQL5
			Java平台	Web服务器	数据库服务器
			Web服务器中，部署了Web应用程序：网站稿件管理发布系统 	
		对比：WA（Linux + Apache + Mysql + PHP）LAMP架构

3）关注服务器的目录结构
		整合了Tomcat6、JDK1.6、MySQL5
		liferay目录（就是拿Tomcat目录改的），Tomcat目录结构（面试题）
<1>bin目录：命令、启动项
						startup.bat			启动Tomcat服务器
						shutdown.bat		关闭Tomcat服务器

<2>conf目录：服务器的配置描述文件	大多xml配置文件
		比如：server.xml

```xml
部分内容：	Tomcat默认端口8080，目前改为80，可以忽略
		连接		端口号	80
<Connector port="80" protocol="HTTP/1.1" connectionTimeout="20000" redirectPort="8443" URIEncoding="UTF-8"/>
连接超时时间：20000	毫秒，就是20秒
		客户端向Web服务器发请求，如果超过20秒未响应，会提示超时错误
URIEncoding="UTF-8"		URi编码指定为UTF-8
		说明整个项目都统一采用UTF-8编码
结论：测试用例中的中文也需要采用UTF-8编码保存，比如CSV
```

<3>lib目录：存放第三方类库 class libary
		java开发好的程序，是类文件class，压缩为jar包（压缩比同.zip)

<4>logs目录：Tomcat的日志
		便于在测试接口过程中，关注后台程序运行的异常、错误！

比如：

<5>webapps目录：部署Web应用（app）
		java开发的Web项目，打包后，放在该目录下，称为“部署”
		其中含有大量接口程序！
		不能单独直接运行，需要Tomcat的支持，称Tomcat就是Web应用的“容器”	

4）启动和关闭所有服务：

​	liferay目录下：
​			startall.bat		启动所有服务
​			shutdown.bat		关闭所有服务

分析：startall.bat脚本
			先启动mysql5
	

```
start /b mysql5\bin\mysqld --defaults-file="mysql5/my.ini"
set JAVA_HOME=jdk1.6.0_07
bin\startup.bat
```

虚拟机中打开浏览器：

```
http://localhost/web/guest/home
用户名：test01～test50	50个账户
密码：1111
```

![image-20220606174907030](/Users/liuxueman/Library/Application Support/typora-user-images/image-20220606174907030.png)

要求：查看服务器Win7的ip地址

使用客户端访问服务器：

```
http://10.211.55.11/web/guest/home
```

## 五、项目业务模块需求	CURD（增删查改）

### 1、项目分为3个模块

<1>用户的登陆模块
	功能点：登陆user_login、退出user_logout	命名建议：见名知意	**规范**

<2>稿件管理模块
	功能点：增加稿件（add_manuscript）
					查询稿件（search_manuscript）
					显示稿件（show_manuscript)	查看某条稿件具体信息
					审批稿件（check_manuscript  对稿件的状态进行修改）
					删除稿件（remove_manuscript）...

<3>文档上传下载模块
		功能点：查询文档（search_document）
						新建文件夹（add_folder）
						上传文档（upload_document）
						下载文档（download_aocument）..

### 2、性能需求？常用的性能指标

#### 1）时间特性

ART：平均事务响应时间
			许多用户，都会执行某事务，执行多次，工具会统计出这些事务平均响应时间。在各种压力下，ART要求控制在3秒以内。

#### 2）点击率和吞吐量的变化趋势

Hits per Second：点击率	每秒的请求数	形容压力的大小
			目前的点击数 指的是请求数，动作中的一个点击，可能会发起多个请求；

Throughputs：吞吐量	服务器处理的数据量 

TPS：每秒事务数	度量服务器处理能力的指标
		比如：一天能够增加10000个稿件或文档	
					每增加一个稿件，就算是一个事务，结合二八定律：80%的交易量（交易、事务Transaction），发生在20%的时段内（10000x*80%）/（24*x60x*60*x20%）=0.463笔/秒

​	天猫双11的峰值TPS：
​			2016 	12.5万	笔/秒
​			2017 	25万		笔/秒
​			2018		49.7万	笔/秒
​			2019		75万		笔/秒

#### 3）最大并发用户数：目前预期到20个

​	以目前环境配置：要求200用户在线，最多需要测试20用户并发
​									结合递增测试策略，分别测试10个、20个用户并发

**重要规律**：100用户并发的压力，相当于1000用户在线的压力	1:10 比例

#### 4）资源使用率：重点关注被测系统服务器的系统资源

​	CPU使用率：阈值80%	不能超过80%
​	内存使用率：阈值80%	

## 六、设计性能测试计划

### 面试题：请描述测试计划中有哪些内容？人力、物力、财力

1）说明测试环境、项目背景
2）功能模块、功能点
3）操作规范、测试 的数据
4）虚拟用户数量、执行次数
5）安排在线测试、并发测试、递增测试
6）项目进度安排、任务分工、项目评判标准
7）提交物，用例、脚本、结果报告
8）测试结果报告依据

## 七、设计并执行性能测试用例

### 思路：

​		接口测试中，一次功能的访问，可以设计一条用例	
​				包含1个或多个请求要依次发送，主要观察数据包是否正确；
​			性能测试中，基于接口功能，并高于功能，先确保功能正常、可用；
​			一般将一个“场景”Scenario，设计为一条用例；
​	比如：安排20个VU并发进行一次登陆，观察性能指标；
​				安排些“人”，做些“事”，做多久，多少次，如何发起，观察指标
​		当前JMeter就是一个“测试计划”，包括线程组、取样器、监听器等

### 1、用例1:针对用户登陆功能点进行10～20VU的并发测试，

#### 1）测试计划：user_login.jmx	测试工具：JMeter

#### 2）目的：模拟10～20VU，并发执行登陆事务

#### 3）使用Badboy录制脚本，使用JMeter调试、增强脚本；（核心：协议）

​	说明：必要时可用使用Fiddler抓包，辅助分析协议细节是否合理
​	技巧：监控面板的“审查员”选项卡，观察请求包头，WebForms视图观察请求参数细节（QueryString和Body）、响应包的内容

注意：重新录制脚本，需要重启Badboy工具！为了清除缓存
			由于之前的操作，会在浏览器产生“缓存”，临时存在浏览器中；
			如果继续录制，会导致无需从服务器重新获取数据，导致录制内容不完整

建议：为当前项目新建工作目录，保存脚本、用例、数据文件等
			测试机中新建Work01目录，在其中新建script目录，存放脚本

```
访问首页的地址：如果在本地访问服务器，可用使用Localhost
http://10.211.55.11/group/10779/articles
登陆账号采用：test01		1111 是后续寻找请求数据包的依据
录制后，保存为user_login.bb
导出为user_login.jmx		file->Export to JMeter	导出到JMeter
使用JMeter打开此文件，进行调试：
		添加监听器：察看结果树		分析数据包，调试脚本的功能
```

问题：如何修改Badboy默认的浏览器？打开某浏览器，设置为默认即可！

#### 4）对登陆后的状态进行“跟随重定向”，确保状态信息的延续；

​	自动重定向：直接定位到新的地址，之前的数据丢失！
​	跟随重定向：带着旧的数据定位到新的地址，能记录之前的信息！
​						（新建请求默认的方式，可以巧妙实现自动的关联）

#### 5）添加检查点：对HTTP响应码、响应文本进行检查

```
	分三步：先找到相应请求，再添加断言（响应断言），再添加监听器（断言结果）
<1>找到相应请求：引起响应结果的请求，其结果需要检查
​		技巧：查看结果树	寻找数据关系
​		加在公共位置，是共享的，所有请求都需要检查！
<2>在“Step1”下，添加断言：“响应断言”	所有请求共享
​		响应断言1-HTTP响应码		检查HTTP响应码为200
​	选择：仅对当前请求其作用，不能算Sub	子请求（个别子请求响应码302）
​	选择：响应代码（响应码）	包括：200
​	错误提示：预期响应码为200，而实际不是！

在“请求2”下，添加“断言”：响应断言
	响应断言2-响应文本	检查响应文本含有登陆的用户名提示
	选择：仅对当前请求	响应文本	包括
	测试模式：<span>Welcome test01!</span>
	注意：检查的文本应该从响应的数据包，而不是网页中获取！
												（协议文本）					（UI界面）
													Text视图							HTML界面
	失败消息：预期含有欢迎的用户名，而实际未出现！
<3>在“测试计划”下添加监听器：断言结果
```



#### 6）对登陆的账号进行参数化：用户名、密码

​	可用数据：test01～test50		1111

```
思路：类型				+			数据			+					策略
		CSV数据					自己准备文件					所有线程	交替、循环使用
		入参：用户名、密码			出参：用户名
	性能测试，要促成业务的实现，建议都使用有效数据。
<1>准备数据文件：	新建data目录，在data目录下，新建user_login.txt
	username,password
	test01,1111
	test02,1111		
	test03,1111

<2>在“线程组”下，添加“配置元件”：CSV数据配置
	1）名称：CSV数据文件配置
	2）注释：针对登陆的用户名和密码进行参数化
	3）文件名：user_login.txt
	4）文件编码：UTF-8
	5）变量名称：username,password
	6）忽略首行：True
		后续都默认，比如：允许循环使用数据
									线程共享模式：所有线程
<3>将请求2中的请求参数改为变量
		test01改为${username}
		1111	改为 ${password}
		将响应断言2	中的出参也修改:
			改为
			<span>Welcome ${username}!</span>
			<span>Welcome ${username}!</span>
	
	思路：功能测试要测试无效数据
			性能测试要准备有效数据，促成功能的实现，进一步观察性能指标！
			——促成脚本成功执行！保证一定的事务的成功率
			
```



#### 7）对核心登陆请求添加事务：用户登陆事务

​	目的：便于获取和事务有关的指标，比如
​				ART	平均事务响应时间、最大事务时间、
​				TPS	每秒事务数
​	效果：如果不添加事务，JMeter默认将每个请求都单独统计
​				加了事务后，一个事务内可用有多个请求，作为一个独立的单元，便于统计和分析；也便于后续作为并发的起点！

```
在Step1下，添加“逻辑控制器”：“事务控制器”
将事务控制器，命名为：用户登陆事务
将事务控制器	拖拽到请求1后，和请求1并列
将请求2	拖拽到“事务控制器”下	
```



#### 8）针对核心事务添加集合点：同步定时器 Synchronizing Timer

​	确保严格的并发

```
1.名称：同步定时器
2.注释：为登陆事务设置并发的集合点
3.模拟的用户组的数量：0	表示全部	所有线程参与并发
									10		表示期望有10个用户并发
4.超时时间：10000	毫秒，就是10秒
					如果写0，表示无限等待，后续只能强行关闭JMeter
					
```



#### 9）线程组中指定合适的线程数：VU数	虚拟用户数

```
VU数：10
```



#### 10）添加一些常用的“监听器”：

​		察看结果树、断言结果、图形结果、用表格察看结果、聚合报告、Hits per Second 点击率（每秒请求数）、TPS 每秒事务数

​	说明：监听器不是添加的越多越好，而是够用就行；
​				过多的添加会影响测试机的执行效率，影响压测的效果

```
性能测试存在共同点：和LoadRunner类比，都具有以下概念
	场景（测试计划）、多线程（多用户）、请求（取样器）、事务、性能指标（ART、TPS、点击率）	触类旁通
	规律：带有jp@gc	开头的都是为JMeter扩展的插件plugin
					（Jmeter\lib\ext	扩展目录下	添加了 jir包）
	jp@gc - Hits per Second	点击率	每秒客户端发送的请求数
					可以监控客户端发起的压力的大小
					点击率越高，表示单位时间内来着客户的压力越大
					并发测试时，很短时间内发送很多请求，点击率会提高
	jp@ggc - Transactions per Second  每秒事务数
					度量服务器处理能力的指标
					该值越大，说明服务器的处理能力较强
					前提：其他指标比较正常，比如CPU使用率不超过80%
```

# day07

#### 11）在JMeter的GUI（图形用户界面）中调试运行通过，再使用命令行方式（非GUI方式）执行计划，得出测试结果报告（HTML网页格式）。

```
面试题：平时是如何运行JMeter测试计划？是否用过非GUI模式运行？
对比：
之前：采用GUI模式运行	GUI图形用户界面
		在打开JMeter图形界面的情况下运行“测试计划”
		优点：直观、明了，便于脚本调试！
		缺点：对测试机的开销比较大，不便于生成结果报告文档；
目前：采用非GUI模式（命令行方式） 执行jmx文件（测试计划）
		缺点：看不到执行的中间过程
		优点：节约测试机资源，可以指定输出结果报告文档！
		jmeter -n -t [jmx file] -l [results file] -e -o [Path to web report folder]
		jmeter -n -t jmx文件路径名 -l 结果文件 -e -o 导出结果报告的目录名	
		含义：-n		不用图形界面方式运行JMeter	Not GUI	非GUI模式
				 -t		指定jmx文件路径名，，建议使用绝对路径
				 -l		指定记录结果的日志文件	比如：result1.jtl	log日志
				 -e		在脚本运行结束后生成HTML报告	网页版
				 -o		指定HTML报告输出的路径名
注意1:在运行命令之前，需要先关闭JMeter界面！
		并且确保测试计划在GUI界面中调试通过，能够正常运行！
注意2:如何后续要重新执行该计划，需要先删除两个文件
			jmeter.log	和 result1.jtl
	比如：运行user_login.jmx	，并导出结果报告
	jmeter -n -t /Users/liuxueman/Desktop/达内/达内网课笔记/Jmeter性能测试/badboy生成文件/user_login.jmx  -l result1.jtl -e -o /Users/liuxueman/Desktop/达内/达内网课笔记/Jmeter性能测试/badboy生成文件/非图形界面日志

运行结束后，在res1目录下，打开首页index.html	报告的首页、入口页
DashBoard：仪表盘	适合统计和分析
Charts：图标	从不同角度分析

jmeter -n -t c:\users\MAC\Desktop\script\ceshi\user_login.jmx  -l result1.jtl -e -o c:\users\MAC\Desktop\script\ceshi\aaa

	第2次运行：重新修改了并发规模	20个VU
						删除日志文件后
				
```

执行用例细节：

##### 2、用例2:针对稿件管理中的查询稿件共进行10～20VU的并发测试

脚本名称：search_manuscript.jmx

1)目标：模拟10～20VU，并发执行查询稿件事务；
2）使用Badboy录制脚本，使用Jmeter回放、配置、增强脚本；
			业务中使用高级查询，结合四个条件，要求同时满足（选择 所有）：
			编号number 	版本version	标题title		内容content
				25345				1.0					微软				2月1日

```
首页地址：http://10.211.55.11/web/guest/home
重新打开Badboy，录制脚本	search_manuscript.bb
导出为：search_manuscript.jmx
```

3）对JMeter进行设置，比如登陆后的状态进行跟踪，改为“跟随重定向”

```
将2、3、4请求，设置为“跟随重定向”
问题：回放时，出现中文乱码问题！（中文字符编码问题）
分析：Badboy录制后的脚本，在JMeter中能够正常显示中文，说明录制时是正常的；但是发送时出现乱码！
		JMeter默认请求发送的编码：Latin-1（ISO8859-1）西欧编码
				不支持中文！显示为？？
				当前项目要求采用UTF-8
解决方法：在JMeter请求中，设置“内容编码”：UTF-8
```

4）添加检查点：对HTTP响应码、响应文本（稿件编号）进行检查

```
三步：找到相应请求、添加响应断言、添加断言结果
			找关系				查数据				看结果
查看结果树：
			HTML视图	直观		Text视图	协议文本
								检查的是数据包文本
公共位置：
		响应断言1-HTTP响应码
				检查HTTP响应码为200
				针对当前请求
				测试字段：响应代码
				包括：200
				错误提示：预期HTTP响应码为200，而实际不是！
找到相应请求：第3个	其结果查到了稿件的编号
响应断言2-响应文本
	检查响应文本中含有稿件编号的超级连接文本
应用范围：当前请求
响应文本：包括
检查的文本：">25345</a>
错误提示：预期结果含有稿件编号的超级链接，而实际没有！
```

5）对查询条件和结果进行参数化，要求采用UTF-8编码

​			入参						出参

```
类型：CSV数据配置	
数据： search_manuscript.txt
策略：所有线程

”线程组“下添加：配置元件 CSV Data Set Config
    针对稿件查询条件进行参数化
	文件名：search_manuscript.txt
	文件编码：UTF-8		JMeter读取CSV文件的方式
	变量名：number,version,title,conteng
	忽略首行：True
	其他默认
	
	请求的入参
	${number}
	${version}
	${title}
	${content}
	检查点中的出参：${number}
	">25345</a
	改为
	">${number}</a
	
	在线编码解码工具：https://www.bejson.com/enc/urlencode/
		url encode ：URL编码		将汉字转化为编码格式	UTF-8
														%E8%B0%B7%
		url	decode ：URL解码		将编码转化为汉字
	
面试题：如何解决自动化中的中文编码问题？（小结）
1.关注项目采用的编码，比如UTF-8
2.注意数据库保存数据的编码：UTF8
3.资源文件需要另存为：UTF-8		参数化数据的来源
4.录制时要保证中文正常显示		录制效果
5.CSV数据配置，指定文件读取方式：UTF-8 	读取数据方式
6.JMeter请求中，指定UTF-8		发送的方式
总结为：编码 和 解码 要统一！	英文和数字是不会乱码
			encode	decode
	
	
```

6）对核心请求添加事务：查询稿件事务
7）对核心事务添加集合点：同步定时器Synchronizing Timer

```
对核心事务进行严格的并发测试
期望的并发用户数：0		表示全部线程
超时时间：10000毫秒		表示10秒
```

8）指定和并发有关的线程数

```
比如：10	表示10个VU并发
```

9）添加常用的监听器：察看结果树、断言结果、图形结果、用表格察看结果、聚合报告、点击率、每秒事务数
10）现在JMeter的GUL（图形用户界面）中调试运行通过，再使用非GUI方式（命令行）执行计划，得出结果报告（HTML网页形式）

```
指定为20VU并发
jmeter -n -t c:\users\MAC\Desktop\script\xiugaihou\bbb\search_manuscript.jmx  -l result1.jtl -e -o c:\users\MAC\Desktop\script\xiugaihou\bbb\hehe\res1

指定为10VU并发
jmeter -n -t c:\users\MAC\Desktop\script\xiugaihou\bbb\search_manuscript.jmx  -l result1.jtl -e -o c:\users\MAC\Desktop\script\xiugaihou\bbb\hehe\res2

```

```
查询稿件事务	10	0	0.00%	119.70	40	213	107.00	211.40	213.00						
213.00	15.50	302.03	19.91
											网络传输率
```

```
查询稿件事务	20	0	0.00%	321.95	40	562	332.00	551.90	561.50	562.00	24.69	481.02	31.70


```

问题1:性能测试、压力测试、负载测试有何区别？

性能测试：为了满足性能需求的一种测试策略；追求多快好省的目标；为了测试服务器的性能，需要发起压力、负载；

压力测试：通过不断加压，发现系统的瓶颈；比如时间超过2秒
						（见好就收）

负载测试：通过不断加压，发现系统性能的极限；（追求极限）

共同点：递增测试

##### 问题2：一台客户端有三百个客户与三百个客户端有三百个客户对服务器施压，有什么区别？

答：一台客户端发送请求时，客户端的ip地址都是一样的；
		不同客户端的IP地址一般不同；
		服务器有时对不同ip会进行任务的分解，为了提高后台的处理效率（类似分配不同的客服为不同客户服务），如果IP都一样，任务都交给一个客服处理，导致其他客服很闲，发挥不出系统性能。
		——服务器的负载均衡机制！

​		解决办法：IP欺骗技术
​							让一台客户端模拟许多IP地址，向服务器发送请求。

#### 3、用例3:针对稿件管理模块中的增加稿件进行10～20VU的并发测试

测试计划：add_manuscript.jmx

1）目的：模拟10～20VU，并发执行增加稿件事务；

2)使用Badboy老录制脚本，使用JMeter回放、调试、增强脚本；

```
录制细节：
稿件名称：hello123
		稿件内容：hello789	都属于已知条件，便于脚本定位、分析
		保存为：add_manuscript.bb
		导出为：add_manuscript.jmx
```

3）使用JMeter调试，将中间请求，设置为“跟随重定向”

4）添加检查点：针对HTTP响应码、响应文本：稿件名称 进行检查

```
三步：1.找到请求	2.添加断言	3.监听器：断言结果
响应断言1-HTTP响应码		加在公共范围
	检查HTTP响应码为200
	应用于当前请求，测试字段：响应代码
	包括：200
	错误提示：预期HTTP响应码为200，而实际不是！
	
确定第5个请求为相应请求，其结果需要检查文本（察看结果树）
响应断言2-响应文本
检查响应文本含有成功提示和稿件名称（出现在文本框中）
	应用范围：当前请求
	响应文本	包括
	检查的文本：都从Text文本视图中获取，不要选取网页页面内容 
		您的请求执行成功
		type="text" value="hello123"
	错误提示：预期结果含有稿件标题，而实际未找到！
```

5）对稿件名称、内容进行参数化，要求字符集UTF-8

```
名称：CSV数据文件设置
注释：针对添加的稿件标题、内容进行参数化
文件名：add_manuscript.txt
文件编码：UTF-8
变量名称：title,content
忽略首行：True
其他默认

将第5个请求中的参数，进行修改：
	将hello123改为：${title}
	将hello789改为：${content}
	
将检查点：type="text" value="hello123"
	改为：type="text" value="${title}"
	
```

6）对核心请求添加事务：增加稿件事务

```
将第5个请求加入到事务中去，作为一个事务
```

7）对核心事务添加集合点：同步定时器

8）指定合适的线程数

9）添加常用的监听器：察看结果树、断言结果、图形结果、用表格察看结果、聚合报告、点击率、每秒事务数TPS

10）现在JMeter的GUI中调试通过，再使用非GUI方式执行计划，得出结果报告。



#### 4、针对稿件管理中的“显示稿件”业务进行脚本增强、调试！

——脚本的“关联技术”（面试加分项）使用JMeter实现

##### 1）什么是关联？

​	接口测试中，多个请求之间的数据有联系；
​	上一个请求返回的结果中带有“动态数据”，作为后续请求的参数，通过关联技术实现；

##### 2）为什么需要关联？

​	前一个请求的出参，作为后续请求的入参；
​				结果动态数据								条件

关键点：存在**动态数据**，后续请求需要使用

##### 3）何处需要关联？

比如：第一个请求获取验证码，是动态生成的、未知的；
			第二个请求需要使用验证码进行登陆，需要关联！

比如：登陆后产生的校验码token（令牌），作为后续请求验证条件；
			由于检验码是动态、随机的，需要关联！

比如：显示稿件业务中，存在关联关系
			查询稿件后，出现了20条最新的稿件信息，比如第1条稿件编号，作为显示稿件请求的条件；由于稿件编号会动态改变，属于动态数据，需要关联。

录制显示稿件脚本：show_manuscript.jmx

​	比如：点击47025

```
请求1:查询最新的稿件列表，列表中出现了稿件编号，是动态数据，比如：47025

请求2:根据稿件编号显示某条稿件信息，需要关联
http://10.211.55.11/group/10779/articles?p_p_id=15&p_p_lifecycle=0&p_p_state=maximized&p_p_mode=view&_15_struts_action=%2Fjournal%2Fedit_article&_15_redirect=%2Fgroup%2F10779%2Farticles%3Fp_p_id%3D15%26p_p_lifecycle%3D0%26p_p_state%3Dmaximized%26p_p_mode%3Dview%26p_p_col_id%3Dcolumn-1%26p_p_col_count%3D1%26_15_struts_action%3D%252Fjournal%252Fview%26_15_tabs1%3Darticles&_15_groupId=10780&_15_articleId=47025&_15_version=1.0


```

##### 4)如何进行关联？具体步骤

<1>找到相应请求：导致第一次产生动态数据响应的请求
				请求的结果列表中，第一次出现了动态数据，比如：47025
				技巧：察看结果树	从第1个请求开始搜索，确定是第3个请求
									（HTML视图更直观，Text视图 观察协议数据包）
			切换到Text视图，获取含有动态数据的左右边界文本！

```
type="checkbox" value="47025_version_1.0" onClick	
```

备用

<2>在“相应请求”下，添加“后置处理器”：正则表达式处理器
			正则表达式：也称为规则表达式，能够通过一些特殊符号，对文本进行匹配、搜索、定位、替换等操作；

​	目的：在相应请求发送后，根据左右边界规则，自动获取“动态数据”，存于关联参数num中，供后续请求使用${num}

```
1.名称：正则表达式提取器
2.注释：针对稿件编号进行关联
3.应用范围：默认		当前请求	Main	Sample	only
4.要检查的响应字段：默认	主体		动态数据一般在主体中
5.引用名称：num		就是关联参数、变量的名称
									提取的动态数据会存于num中，供后续请求使用
6.正则表达式：
type="checkbox" value="(\d{5})_version_1.0" onClick=
						元字符			限定符
				（允许出现什么）	（允许出现几次）
				.	任意字符			*	任意多次
				\d	任意数字		{11}	固定11位
	说明：.*	任意字符，可以出现任意多次
			\d*	任意数字，可以出现任意多次
			\d{5}		任意数字，固定出现5次，表示5位整数
	7.模版：$1$	希望从结果中匹配到几个符合条件的数据
	8.匹配数字：1		从匹配到的数据中获取第1个
			
```

<3>讲后续请求参数中的“**静态数据**”改为**关联参数**（动态数据）

```
比如：第4个请求
参数名						参数值
_15_articleId			47025改为：${num}
```

补充：针对第4个请求添加断言

```
名称：响应断言-响应文本
注释：检查响应文本含有稿件编号
应用范围：当前请求
测试字段：响应文本
模式匹配规则：包括
测试模式：${num}
错误提示：未找到预期显示的稿件编号
```

#### 面试题：

```
正则表达式中，(.*)和(.*?)的区别？
		.		元字符，表示匹配任意字符
		*		限定符，表示可以出现任意多次
		?		限定符，表示可以出现0或1次		 最多1次
		+		限定符，表示可以出现1或多次		至少1次
比如文本如下：AheheBAhahaBAxixiB
正则表达式：A(.*)B		贪婪匹配	满足A开头，B结尾，中间都要！
										匹配结果：heheBAhahaBAxixi
					A(.*?)B		唯一匹配	?最多一次
										匹配结果：hehe
结论：分析协议数据包，根据显示格式进行取舍！
			具体问题具体分析，具体文本具体对待
```

#### 面试题：自动化测试中，参数化和关联有何异同点？

```
共同点：都是使用变量、参数表示数据		以不变应万变！
		${username}	${password}	${title}	${content}
		${num}	关联参数
		变量名不变，变量的值可以改变
区别：数据来源不同
	参数化：数据由测试人员提供，比如通过CSV文件设置入参、出参数据，属于预先设计好的数的已知数据；（主动提供）
	关联：数据由之前请求的结果中提取的，是动态数据；（被动接受）	
				比如新添加用户的id、新添加的稿件的编号num
				一般通过“正则表达式提取器”根据规则表达式动态获取
				目标：让自动化脚本具有自动适应性！
```

#### 面试题：JMeter测试计划中有哪些要素？

```
核心：测试计划、线程组、取样器（请求）、监听器
增强：检查点：断言	断言结果
		参数化：测试计划中的全局变量、配置元件CSV数据设置、
						函数助手对话框（预先设计好功能函数，直接调用）
						${__Random(1,1000,a)}	获取1～1000的随机数
					存于变量a中，后续所有${a}继续使用
		事务：逻辑控制器-事务控制器	为了获取事务指标、并发起点
		并发：同步定时器	Synchronizing Timer	严格的并发
				（集合点）等待预期的虚拟用户到达集合点时并发执行
		请求间隔：定时器-固定定时器、高斯随机定时器
		管理Cookie：HTTP	Cookie管理器
		管理请求头：配置元件-HTTP信息头管理器
		关联：后置处理器——正则表达式提取器
				自动：Cookie管理器、跟随重定向...
		验库：JMeter访问数据库
					配置元件-JDBC链接配置		连接某数据库的配置
					取样器—JDBC请求		发送SQL语句
					结合断言对结果进行检查
```

